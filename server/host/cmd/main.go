// Code generated by nitric plugin builder - DO NOT EDIT.
//
// Source: github.com/nitrictech/plugins-poc/host/hacks/build

package main

import (
	"flag"
	"log"

	"github.com/nitrictech/nitric/server/runtime/storage"
	"github.com/nitrictech/nitric/server/runtime/pubsub"
	"github.com/nitrictech/nitric/server/runtime/service"
	"github.com/nitrictech/nitric/server/runtime"
    "github.com/nitrictech/nitric/server/runtime/plugin"
	awslambda "github.com/nitrictech/nitric/engines/terraform/plugins/awslambda"
)

var userCommand = flag.String("c", "", "The command to run")

// storagePluginRegistry maps plugin names to their storage plugin constructors
var storagePluginRegistry = map[string]plugin.Constructor[storage.Storage]{
}

// pubsubPluginRegistry maps plugin names to their pubsub plugin constructors
var pubsubPluginRegistry = map[string]plugin.Constructor[pubsub.Pubsub]{
}

func main() {
	flag.Parse()

	if userCommand == nil || *userCommand == "" {
		log.Fatalf("No command provided")
	}

    // Register all storage plugins
	err := runtime.RegisterPlugins(storage.Register, storagePluginRegistry)
	if err != nil {
		log.Println(err)
	}

    // Register all pubsub plugins
	err = runtime.RegisterPlugins(pubsub.Register, pubsubPluginRegistry)
	if err != nil {
		log.Println(err)
	}

	// Register service plugin
	service.Register(awslambda.Plugin)

    // Start the host
    runtime.Start(*userCommand)
}
