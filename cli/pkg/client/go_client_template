// Code generated by Nitric SDK generator. DO NOT EDIT.

package {{.Package}}

import (
	"fmt"
	"os"

	{{ if .Buckets }}
	storagepb "github.com/nitrictech/nitric/proto/storage/v2"
	{{ end }}

	"github.com/nitrictech/nitric/client/go/nitric"
	"google.golang.org/grpc"
	"google.golang.org/grpc/credentials/insecure"
)

// Client provides access to nitric application resources
type Client struct {
	{{range .Buckets}}{{.PascalCase}} *nitric.Bucket
	{{end}}
}

// NewClient creates a new set of all bucket clients
func NewClient() (*Client, error) {
	address := os.Getenv("NITRIC_SERVICE_ADDRESS")
	if address == "" {
		address = "localhost:50051"
	}

	cc, err := grpc.NewClient(address, grpc.WithTransportCredentials(insecure.NewCredentials()))
	if err != nil {
		return nil, fmt.Errorf("failed to connect to nitric runtime server: %w", err)
	}
	
	{{ if .Buckets }}
	storageClient := storagepb.NewStorageClient(cc)
	{{ end }}

	return &Client{
		{{range .Buckets}}{{.PascalCase}}: nitric.NewBucket(storageClient, "{{.Unmodified}}"),
		{{end}}
	}, nil
}